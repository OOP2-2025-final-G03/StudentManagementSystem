{% extends active_template %}

{% block extra_css %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/list.css') }}">
{% endblock %}

{% block page_title %}ユーザー管理{% endblock %}

{% block main_content %}
    <div class="list-card">
        
        <div class="list-header">
            <h2>{{ title }}</h2>
            <p>システムに登録されているユーザーを管理します。</p>
        </div>

        {% set current_role = request.args.get('role', 'all') %}
        <div class="filter-tabs">
            <a href="{{ url_for('user.list', role='all') }}" class="filter-tab {{ 'active' if current_role == 'all' else '' }}">すべて</a>
            <a href="{{ url_for('user.list', role='student') }}" class="filter-tab {{ 'active' if current_role == 'student' else '' }}">学生</a>   
            <a href="{{ url_for('user.list', role='teacher') }}" class="filter-tab {{ 'active' if current_role == 'teacher' else '' }}">教員</a>
        </div>

        <div class="list-actions">
            <div class="search-box">
                <input type="text" placeholder="名前、ID、クラスで検索...">
            </div>
            <a href="{{ url_for('user.new_user_form') }}" class="btn-add">
                <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 5v14M5 12h14"></path></svg>
                新規登録
            </a>
        </div>

        <div class="table-responsive">
            <table class="styled-table">
                <thead>
                    <tr>
                        <th width="80">ID</th>
                        <th>氏名</th>
                        <th width="100">区分</th>
                        {% if current_role == 'student' %}
                            <th>クラス</th>
                        {% else %}
                            <th>担当教科</th>
                        {% endif %}
                        <th>ステータス</th>
                        <th width="140">操作</th>
                    </tr>
                </thead>
                <tbody>
                    {% if users|length > 0 %}
                        {% for user in users %}
                        <tr>
                            <td style="font-family: monospace;">{{ user.id }}</td>
                            <td>
                                <div class="user-cell">
                                    <div class="avatar-placeholder">{{ user.name[0] }}</div>
                                    <span class="user-name-text">{{ user.name }}</span>
                                </div>
                            </td>
                            <td>
                                <span class="role-badge {{ 'role-student' if user.role == 'student' else 'role-teacher' }}">
                                    {{ '学生' if user.role == 'student' else '教員' }}
                                </span>
                            </td>
                            <td>{{ user.info }}</td>
                            <td>
                                <span class="status-badge {{ 'status-active' if user.status in ['在籍', '常勤'] else 'status-inactive' }}">
                                    {{ user.status }}
                                </span>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <a href="{{ url_for('user.edit', user_id=user.id) }}" class="action-link edit-link">
                                        編集
                                    </a>
                                    <form method="post"
                                        action="{{ url_for('user.delete', user_id=user.id) }}"
                                        style="display:inline;"
                                        onsubmit="return confirm('本当に削除しますか？')">
                                        <button class="action-link delete-link" type="submit">
                                            削除
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px; color: #94a3b8;">
                                データが見つかりませんでした。
                            </td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>
{% endblock %}